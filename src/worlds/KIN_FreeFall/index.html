<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Circles' head scripts [REQUIRED] -->
    <circles-start-scripts/>
    <!-- Physics script goes after the Circles' head scripts [IMPORTANT]-->
    <script src="/global/js/libs/aframe-physics-system.min.js"></script>

    <script>
      // Free fall object component
      AFRAME.registerComponent('physics-object', {
        schema: {
          initialPosition: {type: "vec3"}
        },

        init: function () {
          const CONTEXT_AF = this;

          CONTEXT_AF.el.addEventListener('resetPosition', function (event) {
            CONTEXT_AF.el.setAttribute('position', CONTEXT_AF.data.initialPosition);
            console.log('Resetting position!');
          });

          // position the physics object at it's starting position
          CONTEXT_AF.el.emit('resetPosition', {});
        }
      });
    </script>

  </head>
  <body>
    <!-- a-scene with 'circles-properties' component [REQUIRED] -->
    <a-scene circles_properties physics="debug: true;">
      <!-- assets -->
      <a-assets timeout="10000">

        <!-- Circles' built-in assets [REQUIRED] -->
        <circles-assets/>
      </a-assets>

      <!-- Circles' built-in avatar [REQUIRED] -->
      <circles-avatar/>

      <!-- ===================== -->
      <!-- Free fall experiment -->

      <!-- Boxes -->
      <a-box class="freeFallObject" physics-object="initialPosition: -2 9.5 -7" rotation="0 0 0" color="#4CC3D9"></a-box>
      <a-box class="freeFallObject" physics-object="initialPosition: 2 10 -7" rotation="0 0 0" color="#d94a4a" width="2" height="2" depth="2"></a-box>

      <!-- Labels -->
      <a-entity   position="-1.5 1 -1"
                  text="value: Free Fall; align: center"
                  scale="2.5 2.5 2.5">
      </a-entity>
      <a-entity   position="1.5 1 -1"
                  text="value: Reset; align: center"
                  scale="2.5 2.5 2.5">
      </a-entity>

      <!-- Buttons -->
      <a-entity id="freeFallButton" circles-button position="-1.5 0.5 -1"></a-entity>
      <a-entity id="resetButton" circles-button position="1.5 0.5 -1"></a-entity>

      <!-- ===================== -->
      <!-- Floor -->
      <a-plane position="0 0 -4" rotation="-90 0 0" width="100" height="100" color="#7BC8A4" static-body></a-plane>

    </a-scene>

    <!-- Circles' end scripts [REQUIRED] -->
    <circles-end-scripts/>
  </body>
  <script>
    // get all the free fall objects
    let freeFallObjects = document.querySelectorAll(".freeFallObject");

    // Free fall button
    let freeFallButton = document.querySelector('#freeFallButton');
    freeFallButton.addEventListener('click', function () {
      // loop through each free fall object
      freeFallObjects.forEach(element => {
        // enable physics on the object
        element.setAttribute('dynamic-body', '');
      });
    });

    // Reset button
    let resetButton = document.querySelector("#resetButton");
    resetButton.addEventListener('click', function () {
        // loop through each free fall object
        freeFallObjects.forEach(element => {
          // disable physics on the object
          element.removeAttribute('dynamic-body');

          // reset the position of the object
          element.emit('resetPosition', {});
        });
    });
  </script>
</html>
